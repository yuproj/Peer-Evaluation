<!-- templates/teacher_dashboard.html -->
{% extends "base.html" %}

{% block title %}Teacher Dashboard{% endblock %}

{% block content %}
<div class="dashboard">
    <h1>Teacher Dashboard</h1>
    
    <!-- Class Management Section -->
    <section class="dashboard-section">
        <div class="section-header">
            <h2>My Classes</h2>
            <button class="btn btn-primary" onclick="showAddClassModal()">Add Class</button>
        </div>
        <div id="classList" class="class-list">
            <!-- Classes will be loaded here -->
        </div>
    </section>

    <!-- Selected Class Details -->
    <div id="classDetails" class="class-details" style="display: none;">
        <div class="tabs">
            <button class="tab-btn active" data-tab="teams">Teams</button>
            <button class="tab-btn" data-tab="assignments">Assignments</button>
            <button class="tab-btn" data-tab="evaluations">Evaluations</button>
            <button class="tab-btn" data-tab="reports">Reports</button>
        </div>

        <!-- Teams Tab -->
        <div id="teamsTab" class="tab-content active">
            <div class="section-header">
                <h3>Teams</h3>
                <button class="btn btn-primary" onclick="showAddTeamModal()">Add Team</button>
                <button class="btn btn-secondary" onclick="generateAccessLink()">Generate Access Link</button>
            </div>
            <div id="accessLinkDisplay" class="access-link-display" style="display: none;">
                <p><strong>Access Link:</strong></p>
                <div class="link-container">
                    <input type="text" id="accessLink" readonly>
                    <button class="btn btn-secondary" onclick="copyLink()">Copy</button>
                </div>
                <p class="link-expires">Expires: <span id="linkExpires"></span></p>
            </div>
            <div id="teamsList" class="teams-list">
                <!-- Teams will be loaded here -->
            </div>
        </div>

        <!-- Assignments Tab -->
        <div id="assignmentsTab" class="tab-content">
            <div class="section-header">
                <h3>Assignments</h3>
                <button class="btn btn-primary" onclick="showAddAssignmentModal()">Create Assignment</button>
            </div>
            <div id="assignmentsList" class="assignments-list">
                <!-- Assignments will be loaded here -->
            </div>
        </div>

        <!-- Evaluations Tab -->
        <div id="evaluationsTab" class="tab-content">
            <h3>View Evaluations</h3>
            <div class="form-group">
                <label>Select Assignment:</label>
                <select id="evalAssignmentSelect" onchange="loadEvaluations()">
                    <option value="">-- Select Assignment --</option>
                </select>
            </div>
            <div id="evaluationsList" class="evaluations-list">
                <!-- Evaluations will be loaded here -->
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reportsTab" class="tab-content">
            <h3>Generate Student Reports</h3>
            <p style="color: #666; font-style: italic; margin-bottom: 15px;">Select an assignment and a student to view their peer evaluation report.</p>
            <div class="form-group">
                <label>Select Assignment:</label>
                <select id="reportAssignmentSelect" onchange="loadStudentsForReport()">
                    <option value="">-- Select Assignment --</option>
                </select>
            </div>
            <div class="form-group">
                <label>Select Student:</label>
                <select id="reportStudentSelect">
                    <option value="">-- Select Student --</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="generateStudentReport()">Generate Report</button>
            <div id="reportError" style="display: none; color: #721c24; background-color: #f8d7da; padding: 10px; border-radius: 4px; margin-top: 10px;"></div>
        </div>
    </div>
</div>

<!-- Add Class Modal -->
<div id="addClassModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addClassModal')">&times;</span>
        <h2>Add New Class</h2>
        <form id="addClassForm">
            <div class="form-group">
                <label for="className">Class Name</label>
                <input type="text" id="className" placeholder="e.g., CS492A-Fall2025" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Class</button>
        </form>
    </div>
</div>

<!-- Add Team Modal -->
<div id="addTeamModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addTeamModal')">&times;</span>
        <h2>Add New Team</h2>
        <form id="addTeamForm">
            <div class="form-group">
                <label for="teamName">Team Name</label>
                <input type="text" id="teamName" placeholder="e.g., Team 1" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Team</button>
        </form>
    </div>
</div>

<!-- Add Students Modal -->
<div id="addStudentsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addStudentsModal')">&times;</span>
        <h2 id="addMembersModalTitle">Add Members to Team</h2>
        <div id="regularTeamInstructions">
            <p style="margin-bottom: 15px; color: #666;">Enter one student per line in the format: <strong>Full Name StudentID</strong></p>
            <p style="margin-bottom: 15px; color: #666; font-style: italic;">Example: Mike Lee S123456</p>
        </div>
        <div id="guestTeamInstructions" style="display: none;">
            <p style="margin-bottom: 15px; color: #666;">To add a guest to the group, just provide full name.</p>
        </div>
        <form id="addStudentsForm">
            <div class="form-group">
                <label for="studentsTextInput" id="addMembersLabel">Student Information</label>
                <textarea id="studentsTextInput" placeholder="Mike Lee S123456&#10;Sarah Johnson S123457&#10;John Smith S123458" style="width: 100%; height: 150px; padding: 10px; font-family: monospace;" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary" id="addMembersSubmitBtn">Add Students</button>
        </form>
    </div>
</div>

<!-- Add Assignment Modal -->
<div id="addAssignmentModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('addAssignmentModal')">&times;</span>
        <h2 id="assignmentModalTitle">Create Assignment</h2>
        <form id="addAssignmentForm">
            <input type="hidden" id="assignmentId">
            <div class="form-group">
                <label for="assignmentName">Assignment Name</label>
                <input type="text" id="assignmentName" placeholder="e.g., Research Presentation" required>
            </div>
            <div class="form-group">
                <label for="startTime">Start Date & Time</label>
                <input type="datetime-local" id="startTime" step="any">
            </div>
            <div class="form-group">
                <label for="endTime">End Date & Time</label>
                <input type="datetime-local" id="endTime" step="any">
            </div>
            <div style="display: flex; justify-content: space-between;">
                <button type="button" id="deleteAssignmentBtn" class="btn btn-danger" style="background-color: #dc3545; color: white; display: none;">Delete Assignment</button>
                <button type="submit" class="btn btn-primary">Save Assignment</button>
            </div>
        </form>
    </div>
</div>

<!-- Report Modal -->
<div id="reportModal" class="modal">
    <div class="modal-content" style="width: 90%; max-width: 900px; max-height: 80vh; overflow-y: auto;">
        <span class="close" onclick="closeModal('reportModal')">&times;</span>
        <div id="reportDisplay" class="report-display"></div>
        <div style="margin-top: 20px; text-align: center;">
            <button class="btn btn-primary" onclick="downloadReportPDF()">Download as PDF</button>
            <button class="btn btn-secondary" onclick="closeModal('reportModal')">Close</button>
        </div>
    </div>
</div>

<!-- Evaluation Modal -->
<div id="evaluationModal" class="modal">
    <div class="modal-content modal-large">
        <span class="close" onclick="closeModal('evaluationModal')">&times;</span>
        <h2>Teacher Evaluation Form</h2>
        <div id="evaluationForm">
            <!-- Evaluation form will be generated here -->
        </div>
    </div>
</div>

<style>
/* Evaluation Form Styles */
.member-evaluation {
    background: #f9f9f9;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    padding: 12px;
    margin-bottom: 12px;
}

.member-evaluation h4 {
    margin: 0 0 10px 0;
    color: #2c3e50;
}

.evaluation-section {
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
}

.evaluation-section:last-child {
    border-bottom: none;
}

.evaluation-section h3 {
    margin-top: 0;
    color: #2c3e50;
}

.modal-large {
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
}
</style>

<script src="{{ url_for('static', filename='js/teacher.js') }}"></script>
<script src="{{ url_for('static', filename='js/pdf-download.js') }}"></script>
{% endblock %}